## 문제 해설

• 문제 파일
• https://github.com/tangtj/bsc-contract-database/blob/7f04f769d370ea91c581748a74896497ea919a9c/source/
0x6f4217e1eF964D24e2F700E86Cb28ec81cAD5205
• _transfer함수가 호출될 때 _moveDelegates의 인자가 잘못설정되었음
• sender또는 recipient 주소가 다른 주소에게 위임했을 경우에 올바르게 처리하지 못하도록 되어있음
• 공격 시나리오
1. Alice와 Bob이 각각 1000개의 토큰을 갖고있음
- Voting Power : Alice(1000), Bob(1000), Charlie(0)
- Balance : Alice(1000), Bob(1000), Charlie(0)
2. Charlie가 delegate()를 호출하여 자신의 위임받은 사람을 Bob으로 설정합니다.
- Voting Power : Alice(1000), Bob(1000), Charlie(0)
- Balance : Alice(1000), Bob(1000), Charlie(0)
3. Alice가 transfer()를 호출하여 Charlie에게 1000 토큰을 전송합니다:
- Voting Power : Alice(0), Bob(1000), Charlie(1000)
- Balance : Alice(0), Bob(1000), Charlie(1000)

- 패치한 코드대로면 여기서 VP와 Balance는 아래와 같음
    - Voting Power : Alice(0), Bob(2000), Charlie(0)
    - Balance : Alice(0), Bob(1000), Charlie(1000)
4. Alice의 1000표가 Bob이 아닌 Charlie에게 전송됩니다.
5. Charlie가 delegate()를 호출하여 자신의 위임받은 사람을 자기 자신으로 설정합니다:
- Voting Power : Alice(0), Bob(0), Charlie(2000)
- Balance : Alice(0), Bob(1000), Charlie(1000)
6. Bob이 그의 위임받은 사람이므로, 1000표가 Bob에서 차감되고 Charlie에게 추가됩니다.
- Voting Power : Alice(0), Bob(0), Charlie(2000)
- Balance : Alice(0), Bob(1000), Charlie(1000)
7. Bob은 이제 0표를 가지고, Charlie는 2000표를 가집니다.
8. Bob은 투표권만 뺏긴게 아니라 https://github.com/tangtj/bsc-contract-database/blob/7f04f769d370ea91c581748a74896497ea919a9c/source/
   0x6f4217e1eF964D24e2F700E86Cb28ec81cAD5205#L215 의 코드로 인해서 토큰을 타인에게 전송할때마다 underflow때문에 자금이 동결됨


## 문제 수정 방법
 
```function _moveDelegates(address srcRep, address dstRep, uint256 amount)```

위 함수를 아래처럼 수정하면 됨

```function _moveDelegates(address _delegates[msg.sender], _delegates[dstRep], uint256 amount)```

위 적은게 정확하지 않음 moveDelegates 코드 다른 곳에서도 찾아보자!!!!
